function createHttpBackendMock(a,b){function c(a,b,c){return angular.isFunction(a)?a:function(){return angular.isNumber(a)?[a,b,c]:[200,a,b]}}function d(c,d,e,j,k){function l(a){return angular.isString(a)||angular.isFunction(a)||a instanceof RegExp?a:angular.toJson(a)}var m=new MockXhr,n=g[0],o=!1;if(n&&n.match(c,d)){if(!n.matchData(e))throw Error("Expected "+n+" with different data\nEXPECTED: "+l(n.data)+"\nGOT:      "+e);if(!n.matchHeaders(k))throw Error("Expected "+n+" with different headers\nEXPECTED: "+l(n.headers)+"\nGOT:      "+l(k));if(g.shift(),n.response)return h.push(function(){var a=n.response(c,d,e,k);m.$$respHeaders=a[2],j(a[0],a[1],m.getAllResponseHeaders())}),void 0;o=!0}for(var p,q=-1;p=f[++q];)if(p.match(c,d,e,k||{})){if(p.response)(b?b.defer:i)(function(){var a=p.response(c,d,e,k);m.$$respHeaders=a[2],j(a[0],a[1],m.getAllResponseHeaders())});else{if(!p.passThrough)throw Error("No response defined !");a(c,d,e,j,k)}return}throw o?Error("No response defined !"):Error("Unexpected request: "+c+" "+d+"\n"+(n?"Expected "+n:"No more request expected"))}function e(a){angular.forEach(["GET","DELETE","JSONP"],function(b){d[a+b]=function(c,e){return d[a](b,c,void 0,e)}}),angular.forEach(["PUT","POST","PATCH"],function(b){d[a+b]=function(c,e,f){return d[a](b,c,e,f)}})}var f=[],g=[],h=[],i=angular.bind(h,h.push);return d.when=function(a,d,e,g){var h=new MockHttpExpectation(a,d,e,g),i={respond:function(a,b,d){h.response=c(a,b,d)}};return b&&(i.passThrough=function(){h.passThrough=!0}),f.push(h),i},e("when"),d.expect=function(a,b,d,e){var f=new MockHttpExpectation(a,b,d,e);return g.push(f),{respond:function(a,b,d){f.response=c(a,b,d)}}},e("expect"),d.flush=function(a){if(!h.length)throw Error("No pending request to flush !");if(angular.isDefined(a))for(;a--;){if(!h.length)throw Error("No more pending request to flush !");h.shift()()}else for(;h.length;)h.shift()();d.verifyNoOutstandingExpectation()},d.verifyNoOutstandingExpectation=function(){if(g.length)throw Error("Unsatisfied requests: "+g.join(", "))},d.verifyNoOutstandingRequest=function(){if(h.length)throw Error("Unflushed requests: "+h.length)},d.resetExpectations=function(){g.length=0,h.length=0},d}function MockHttpExpectation(a,b,c,d){this.data=c,this.headers=d,this.match=function(b,c,d,e){return a!=b?!1:this.matchUrl(c)?angular.isDefined(d)&&!this.matchData(d)?!1:angular.isDefined(e)&&!this.matchHeaders(e)?!1:!0:!1},this.matchUrl=function(a){return b?angular.isFunction(b.test)?b.test(a):b==a:!0},this.matchHeaders=function(a){return angular.isUndefined(d)?!0:angular.isFunction(d)?d(a):angular.equals(d,a)},this.matchData=function(a){return angular.isUndefined(c)?!0:c&&angular.isFunction(c.test)?c.test(a):c&&!angular.isString(c)?angular.toJson(c)==a:c==a},this.toString=function(){return a+" "+b}}function MockXhr(){MockXhr.$$lastInstance=this,this.open=function(a,b,c){this.$$method=a,this.$$url=b,this.$$async=c,this.$$reqHeaders={},this.$$respHeaders={}},this.send=function(a){this.$$data=a},this.setRequestHeader=function(a,b){this.$$reqHeaders[a]=b},this.getResponseHeader=function(a){var b=this.$$respHeaders[a];return b?b:(a=angular.lowercase(a),(b=this.$$respHeaders[a])?b:(b=void 0,angular.forEach(this.$$respHeaders,function(c,d){b||angular.lowercase(d)!=a||(b=c)}),b))},this.getAllResponseHeaders=function(){var a=[];return angular.forEach(this.$$respHeaders,function(b,c){a.push(c+": "+b)}),a.join("\n")},this.abort=angular.noop}define("constants",[],function(){return{templatePrefix:"angular/templates/",allowedMediaTypes:["image"]}}),function(a,b,c){b.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(a,d){function e(){var a,e,f,i;for(a in h)k(g[a])&&d.cookies(a,c);for(a in g)e=g[a],b.isString(e)?e!==h[a]&&(d.cookies(a,e),i=!0):b.isDefined(h[a])?g[a]=h[a]:delete g[a];if(i){i=!1,f=d.cookies();for(a in g)g[a]!==f[a]&&(k(f[a])?delete g[a]:g[a]=f[a],i=!0)}}var f,g={},h={},i=!1,j=b.copy,k=b.isUndefined;return d.addPollFn(function(){var b=d.cookies();f!=b&&(f=b,j(b,h),j(b,g),i&&a.$apply())})(),i=!0,a.$watch(e),g}]).factory("$cookieStore",["$cookies",function(a){return{get:function(c){var d=a[c];return d?b.fromJson(d):d},put:function(c,d){a[c]=b.toJson(d)},remove:function(b){delete a[b]}}}])}(window,window.angular),define("angularCookies",function(){}),angular.module("CornerCouch",["ng"]).factory("cornercouch",["$http",function(a){function b(a){return"JSONP"===a.method&&(a.params?a.params.callback="JSON_CALLBACK":a.params={callback:"JSON_CALLBACK"}),a}function c(a,b,c){var d=a;return b&&(d=d+"/"+encodeURIComponent(b)),c&&(d=d+"/"+encodeURIComponent(c)),d.replace("%2F","/")}function d(d,e,f){function h(a){g.copy(a||{},this)}var i=c(e,d);h.prototype.load=function(d,e){var h={method:f,url:c(i,d||this._id)};e&&(h.params=e);var j=this;return a(b(h)).success(function(a){g.copy(a,j)})},h.prototype.save=function(){var b;b=this._id?{method:"PUT",url:c(i,this._id)}:{method:"POST",url:i};var d=b.data=this;return a(b).success(function(a){a.id&&(d._id=a.id),a.rev&&(d._rev=a.rev)})},h.prototype.remove=function(){return a({method:"DELETE",url:c(i,this._id),params:{rev:this._rev}})},h.prototype.attach=function(b,d){var e=this;return a({method:"PUT",url:c(i,e._id,d||b.name),params:{rev:e._rev},headers:{"Content-Type":b.type},data:b}).success(function(){e.load()})},h.prototype.detach=function(b){var d=this;return a({method:"DELETE",url:c(i,d._id,b),params:{rev:d._rev}}).success(function(){d.load()})},h.prototype.attachUri=function(a){return c(i,this._id,a)},this.docClass=h,this.uri=i,this.method=f,this.rows=[],this.prevRows=[],this.nextRow=null}function e(b){return a(b.qConfig).success(function(a,c,d,e){e.params&&e.params.limit&&(b.nextRow=a.rows.length==e.params.limit?a.rows.pop():null),b.rows=a.rows})}function f(a,b){a?(this.uri=a,this.method=b||"JSONP"):(this.uri="",this.method="GET")}var g=angular;return d.prototype.getInfo=function(){var b=this;return a({method:"GET",url:this.uri+"/"}).success(function(a){b.info=a})},d.prototype.newDoc=function(a){return new this.docClass(a)},d.prototype.getDoc=function(a){var b=new this.docClass;return b.load(a),b},d.prototype.getQueryDoc=function(a){var b=this.rows[a];if(!b.doc)return this.getDoc(b.id);var c=b.doc;return c instanceof this.docClass?c:(c=this.newDoc(c),b.doc=c,c)},d.prototype.queryView=function(a,c){var d={method:this.method,url:this.uri+a};if(c){c.limit&&c.limit++;for(p in c)switch(p){case"key":case"keys":case"startkey":case"endkey":c[p]=g.toJson(c[p])}d.params=c}return this.qConfig=b(d),e(this)},d.prototype.query=function(a,b,c){return this.queryView("/_design/"+encodeURIComponent(a)+"/_view/"+encodeURIComponent(b),c)},d.prototype.list=function(a,b,c,d){return this.queryView("/_design/"+encodeURIComponent(a)+"/_list/"+encodeURIComponent(b)+"/"+encodeURIComponent(c),d)},d.prototype.queryAll=function(a){return this.queryView("/_all_docs",a)},d.prototype.queryRefresh=function(){return e(this)},d.prototype.queryNext=function(){var a=this.nextRow;return a?(this.prevRows.push(this.rows[0]),this.qConfig.params.startkey=g.toJson(a.key),a.id&&a.id!==a.key&&(this.qConfig.params.startkey_docid=a.id),e(this)):null},d.prototype.queryPrev=function(){var a=this.prevRows.pop();return a?(this.qConfig.params.startkey=g.toJson(a.key),a.id&&a.id!==a.key&&(this.qConfig.params.startkey_docid=a.id),e(this)):null},f.prototype.getDB=function(a){return new d(a,this.uri,this.method)},f.prototype.getUserDB=function(){return this.userDB||(this.userDB=this.getDB("_users")),this.userDB},f.prototype.getUserDoc=function(){var a=this.getUserDB();return this.userDoc=this.userCtx.name?a.getDoc("org.couchdb.user:"+this.userCtx.name):a.newDoc(),this.userDoc},f.prototype.getInfo=function(){var b=this;return a({method:"GET",url:this.uri+"/"}).success(function(a){b.info=a})},f.prototype.getDatabases=function(){var b=this;return a({method:"GET",url:this.uri+"/_all_dbs"}).success(function(a){b.databases=a})},f.prototype.createDB=function(b){var d=this;return a({method:"PUT",url:c(d.uri,b)}).success(function(){d.databases&&d.databases.push(b)})},f.prototype.session=function(){var b=this;return a({method:"GET",url:this.uri+"/_session"}).success(function(a){b.userCtx=a.userCtx})},f.prototype.login=function(b,c){var d="name="+encodeURIComponent(b)+"&password="+encodeURIComponent(c),e=this,f=b;return a({method:"POST",url:this.uri+"/_session",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:d.replace(/%20/g,"+")}).success(function(a){delete a.ok,e.userCtx=a,e.userCtx.name=f})},f.prototype.logout=function(){var b=this;return a({method:"DELETE",url:this.uri+"/_session"}).success(function(){b.userCtx={name:null,roles:[]},b.userDoc={}})},f.prototype.getUUIDs=function(b){var c=this;return a({method:"GET",url:this.uri+"/_uuids",params:{count:b||1}}).success(function(a){c.uuids=a.uuids})},function(a,b){return new f(a,b)}}]),define("CornerCouch",function(){}),define("services/Random",[],function(){var a=angular.module("commissar.services.Random",[]);return a.factory("Random",function(){var a={getHash:function(){return Date.now()+Math.random()+""}};return a}),a}),define("services/Couch",["CornerCouch","./Random"],function(){var a=angular.module("commissar.services.Couch",["CornerCouch","ngCookies","commissar.services.Random"]);return a.factory("Couch",["$rootScope","cornercouch","$q",function(a,b,c){function d(a){return"undefined"!=typeof a}a.cornercouch||(a.cornercouch=b("/couchdb","GET"));var e={_designDocs:{commissar_validation_global:{"_design/validation_global":{_id:"_design/validation_global",language:"javascript",validate_doc_update:function(a,b,c){if("undefined"==typeof a._deleted){if("undefined"==typeof a.type)throw{forbidden:"All documents must have a type"};if(c.db!=="commissar_user_"+c.name&&-1===c.roles.indexOf("+admin"))throw{forbidden:"Cannot alter documents outside your own database"};if("undefined"!=typeof a.created){if(String(parseInt(a.created,10))!==String(a.created))throw{forbidden:"Created timestamp must be in unix format"};if(b&&"undefined"!=typeof b.created&&a.created!==b.created)throw{forbidden:"Cannot alter created timestamp once set"}}if("undefined"!=typeof a.updated&&String(parseInt(a.updated,10))!==String(a.updated))throw{forbidden:"Updated timestamp must be in unix format"}}}}},commissar_validation_users:{"_design/validation_user":{_id:"_design/validation_user",language:"javascript",validate_doc_update:function(a,b,c){if("undefined"==typeof a.author)throw{forbidden:"Cannot create a document without an author field"};if(a.author!==c.name&&-1===c.roles.indexOf("+admin"))throw{forbidden:"Cannot forge authorship as another user"};if("undefined"==typeof a._id)throw{forbidden:"ID is missing"};if(0!==a._id.indexOf(c.name))throw{forbidden:"IDs must start with your username"};if(b){if("undefined"!=typeof b.type&&a.type!==b.type)throw{forbidden:"Cannot change the type of a document"};if("undefined"!=typeof b.author&&a.author!==b.author)throw{forbidden:"Cannot change the author of a document"}}}},"_design/validation_user_media":{_id:"_design/validation_user_media",language:"javascript",validate_doc_update:function(a){if("media"===a.type){if("undefined"==typeof a.title)throw{forbidden:"Media must have a title"};if("undefined"==typeof a.created)throw{forbidden:"Media must have a created timestamp"};if("undefined"!=typeof a.mediaType&&"image"!==a.mediaType)throw{forbidden:"Invalid media type"}}},views:{all:{map:function(a){"string"==typeof a.type&&"media"===a.type&&emit(null,a)}},byAuthor:{map:function(a){"string"==typeof a.type&&"media"===a.type&&emit(a.author,a)}}}}}},pushDesignDocs:function(){var a=c.defer();return e.getSession().then(function(b){if(-1===b.roles.indexOf("+admin"))return a.reject("Cannot push design documents as you are not an admin"),!1;var d=[];Object.getOwnPropertyNames(e._designDocs).forEach(function(a){var b=e._designDocs[a];Object.getOwnPropertyNames(b).forEach(function(c){d.push(e.applyStaticChanges(a,b[c]))})}),c.all(d).then(function(b){a.resolve(b)},function(b){a.reject(b)})}),a.promise},stringifyFunctions:function(a){for(var b in a)a.hasOwnProperty(b)&&("function"==typeof a[b]?a[b]=""+a[b]:"object"==typeof a[b]&&(a[b]=this.stringifyFunctions(a[b])));return a},applyStaticChanges:function(a,b){var d=c.defer(),f=function(a,b){Object.getOwnPropertyNames(a).forEach(function(c){b[c]=a[c]})},g=!0,h=jQuery.extend(g,{},b);return e.stringifyFunctions(h),e.getDoc(a,h._id).then(function(a){f(h,a),a.save().then(function(){d.resolve(!0)},d.reject)},function(){e.newDoc(a).then(function(a){f(h,a),a.save().then(function(){d.resolve(!0)},d.reject)},d.reject)}),d.promise},getDoc:function(b,d){var f=c.defer();return e.databaseExists(b).then(function(c){if(c){var e=a.cornercouch.getDB(b),g=e.newDoc(),h=g.load(d);h.success(function(){f.resolve(g)}).error(f.reject)}else f.reject("Database not found: "+b)},f.reject),f.promise},saveDoc:function(a,b){var d=c.defer();return e.validateDoc(a,null,b).then(function(){e.databaseExists(b).then(function(c){c?a.save().then(d.resolve,d.reject):d.reject("Database not found: "+b)})},function(a){console.error(a),d.reject(a)}),d.promise},newDoc:function(b){var d=c.defer();return e.databaseExists(b).then(function(c){if(c){var e=a.cornercouch.getDB(b),f=e.newDoc();d.resolve(f)}else d.reject("Database not found: "+b)},d.reject),d.promise},validateDoc:function(a,b,d){var f=c.defer(),g=e._designDocs;return e.getSession().then(function(c){var e,h,i;e=jQuery.extend({},c),e.db=d;try{if(0===d.indexOf("commissar_user"))for(h in g.commissar_validation_users)i=g.commissar_validation_users[h],"function"==typeof i.validate_doc_update&&i.validate_doc_update(a,b,e);for(h in g.commissar_validation_global)i=g.commissar_validation_global[h],"function"==typeof i.validate_doc_update&&i.validate_doc_update(a,b,e)}catch(j){if("undefined"==typeof j.forbidden)throw j;f.reject(j.forbidden)}f.resolve(!0)},function(a){f.reject(a)}),f.promise},databaseExists:function(b){var e=c.defer();return d(a.cornercouch.databases)?e.resolve(a.cornercouch.databases.indexOf(b)>-1):a.cornercouch.getDatabases().then(function(){e.resolve(a.cornercouch.databases.indexOf(b)>-1)}),e.promise},getSession:function(){var b=c.defer();return"undefined"!=typeof a.cornercouch.userCtx?b.resolve(a.cornercouch.userCtx):a.cornercouch.session().then(function(){b.resolve(a.cornercouch.userCtx)},b.reject),b.promise},login:function(b,d){var e=c.defer();return a.cornercouch.login(b,d).then(function(){e.resolve(!0)},function(){e.resolve(!1)}),e.promise},logout:function(){return a.cornercouch.logout()},loggedIn:function(){var a=c.defer();return e.getSession().then(function(b){a.resolve(!(!b||!b.name))},a.reject),a.promise},hasRole:function(a){var b=c.defer();return e.loggedIn().then(function(c){c?e.getSession().then(function(c){b.resolve(c.roles.indexOf(a)>-1)}):b.resolve(!1)},b.reject),b.promise}};return e}]),a}),define("services/PostSerializer",[],function(){var a=angular.module("commissar.services.PostSerializer",[]);return a.factory("PostSerializer",function(){var a={serialize:function(a){return $.param(a)}};return a}),a}),define("services/Authentication",["angularCookies","./Couch","./PostSerializer"],function(){var a=angular.module("commissar.services.Authentication",["commissar.services.Couch","commissar.services.PostSerializer"]);return a.factory("Authentication",["Couch","$q","$http","PostSerializer","$rootScope",function(a,b,c,d,e){var f={};return f.userExists=function(c){if("undefined"==typeof c){var d=b.defer();return d.resolve(!1),d.promise}return a.databaseExists(f.getDatabaseName(c))},f.loggedIn=function(){return a.loggedIn()},f.hasRole=function(b){return a.hasRole(b)},f.isAdmin=function(){return f.hasRole("+admin")},f.getUsername=function(){var a=b.defer();return f.loggedIn().then(function(b){b?f.getSession().then(function(b){a.resolve(b.name)},a.reject):a.reject("Not logged in")},a.reject),a.promise},f.login=function(c,d){var f=b.defer();return a.login(c,d).then(function(a){f.resolve(a),e.$broadcast("AuthChange")},function(){f.resolve(!1)}),f.promise},f.register=function(a,e){var f=b.defer();return c.post("/server/register.php",d.serialize({username:a,password:e}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){f.resolve("undefined"!=typeof a.ok?!0:a.error)}).error(function(){f.resolve(!1)}),f.promise},f.getSession=function(){return a.getSession()},f.getDatabaseName=function(a){return"commissar_user_"+a.toLowerCase()},f.logout=function(){a.logout().then(function(){e.$broadcast("AuthChange")})},f}]),a}),function(){function a(a){this.tokens=[],this.tokens.links={},this.options=a||h.defaults,this.rules=i.normal,this.options.gfm&&(this.rules=this.options.tables?i.tables:i.gfm)}function b(a,b){if(this.options=b||h.defaults,this.links=a,this.rules=j.normal,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?j.breaks:j.gfm:this.options.pedantic&&(this.rules=j.pedantic)}function c(a){this.tokens=[],this.token=null,this.options=a||h.defaults}function d(a,b){return a.replace(b?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function e(a,b){return a=a.source,b=b||"",function c(d,e){return d?(e=e.source||e,e=e.replace(/(^|[^\[])\^/g,"$1"),a=a.replace(d,e),c):new RegExp(a,b)}}function f(){}function g(a){for(var b,c,d=1;d<arguments.length;d++){b=arguments[d];for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a}function h(b,e,f){if(f||"function"==typeof e){f||(f=e,e=null),e=g({},h.defaults,e||{});var i,j,k=e.highlight,l=0;try{i=a.lex(b,e)}catch(m){return f(m)}j=i.length;var n=function(){var a,b;try{a=c.parse(i,e)}catch(d){b=d}return e.highlight=k,b?f(b):f(null,a)};if(!k||k.length<3)return n();if(delete e.highlight,!j)return n();for(;l<i.length;l++)!function(a){return"code"!==a.type?--j||n():k(a.text,a.lang,function(b,c){return null==c||c===a.text?--j||n():(a.text=c,a.escaped=!0,--j||n(),void 0)})}(i[l])}else try{return e&&(e=g({},h.defaults,e)),c.parse(a.lex(b,e),e)}catch(m){if(m.message+="\nPlease report this to https://github.com/chjj/marked.",(e||h.defaults).silent)return"<p>An error occured:</p><pre>"+d(m.message+"",!0)+"</pre>";throw m}}var i={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:f,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:f,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:f,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};i.bullet=/(?:[*+-]|\d+\.)/,i.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,i.item=e(i.item,"gm")(/bull/g,i.bullet)(),i.list=e(i.list)(/bull/g,i.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),i._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",i.html=e(i.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,i._tag)(),i.paragraph=e(i.paragraph)("hr",i.hr)("heading",i.heading)("lheading",i.lheading)("blockquote",i.blockquote)("tag","<"+i._tag)("def",i.def)(),i.normal=g({},i),i.gfm=g({},i.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),i.gfm.paragraph=e(i.paragraph)("(?!","(?!"+i.gfm.fences.source.replace("\\1","\\2")+"|"+i.list.source.replace("\\1","\\3")+"|")(),i.tables=g({},i.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),a.rules=i,a.lex=function(b,c){var d=new a(c);return d.lex(b)},a.prototype.lex=function(a){return a=a.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(a,!0)},a.prototype.token=function(a,b){for(var c,d,e,f,g,h,j,k,l,a=a.replace(/^ +$/gm,"");a;)if((e=this.rules.newline.exec(a))&&(a=a.substring(e[0].length),e[0].length>1&&this.tokens.push({type:"space"})),e=this.rules.code.exec(a))a=a.substring(e[0].length),e=e[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?e:e.replace(/\n+$/,"")});else if(e=this.rules.fences.exec(a))a=a.substring(e[0].length),this.tokens.push({type:"code",lang:e[2],text:e[3]});else if(e=this.rules.heading.exec(a))a=a.substring(e[0].length),this.tokens.push({type:"heading",depth:e[1].length,text:e[2]});else if(b&&(e=this.rules.nptable.exec(a))){for(a=a.substring(e[0].length),h={type:"table",header:e[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:e[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:e[3].replace(/\n$/,"").split("\n")},k=0;k<h.align.length;k++)h.align[k]=/^ *-+: *$/.test(h.align[k])?"right":/^ *:-+: *$/.test(h.align[k])?"center":/^ *:-+ *$/.test(h.align[k])?"left":null;for(k=0;k<h.cells.length;k++)h.cells[k]=h.cells[k].split(/ *\| */);this.tokens.push(h)}else if(e=this.rules.lheading.exec(a))a=a.substring(e[0].length),this.tokens.push({type:"heading",depth:"="===e[2]?1:2,text:e[1]});else if(e=this.rules.hr.exec(a))a=a.substring(e[0].length),this.tokens.push({type:"hr"});else if(e=this.rules.blockquote.exec(a))a=a.substring(e[0].length),this.tokens.push({type:"blockquote_start"}),e=e[0].replace(/^ *> ?/gm,""),this.token(e,b),this.tokens.push({type:"blockquote_end"});else if(e=this.rules.list.exec(a)){for(a=a.substring(e[0].length),f=e[2],this.tokens.push({type:"list_start",ordered:f.length>1}),e=e[0].match(this.rules.item),c=!1,l=e.length,k=0;l>k;k++)h=e[k],j=h.length,h=h.replace(/^ *([*+-]|\d+\.) +/,""),~h.indexOf("\n ")&&(j-=h.length,h=this.options.pedantic?h.replace(/^ {1,4}/gm,""):h.replace(new RegExp("^ {1,"+j+"}","gm"),"")),this.options.smartLists&&k!==l-1&&(g=i.bullet.exec(e[k+1])[0],f===g||f.length>1&&g.length>1||(a=e.slice(k+1).join("\n")+a,k=l-1)),d=c||/\n\n(?!\s*$)/.test(h),k!==l-1&&(c="\n"===h.charAt(h.length-1),d||(d=c)),this.tokens.push({type:d?"loose_item_start":"list_item_start"}),this.token(h,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(e=this.rules.html.exec(a))a=a.substring(e[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===e[1]||"script"===e[1]||"style"===e[1],text:e[0]});else if(b&&(e=this.rules.def.exec(a)))a=a.substring(e[0].length),this.tokens.links[e[1].toLowerCase()]={href:e[2],title:e[3]};else if(b&&(e=this.rules.table.exec(a))){for(a=a.substring(e[0].length),h={type:"table",header:e[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:e[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:e[3].replace(/(?: *\| *)?\n$/,"").split("\n")},k=0;k<h.align.length;k++)h.align[k]=/^ *-+: *$/.test(h.align[k])?"right":/^ *:-+: *$/.test(h.align[k])?"center":/^ *:-+ *$/.test(h.align[k])?"left":null;for(k=0;k<h.cells.length;k++)h.cells[k]=h.cells[k].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(h)}else if(b&&(e=this.rules.paragraph.exec(a)))a=a.substring(e[0].length),this.tokens.push({type:"paragraph",text:"\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1]});else if(e=this.rules.text.exec(a))a=a.substring(e[0].length),this.tokens.push({type:"text",text:e[0]});else if(a)throw new Error("Infinite loop on byte: "+a.charCodeAt(0));return this.tokens};var j={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:f,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:f,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};j._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,j._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,j.link=e(j.link)("inside",j._inside)("href",j._href)(),j.reflink=e(j.reflink)("inside",j._inside)(),j.normal=g({},j),j.pedantic=g({},j.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),j.gfm=g({},j.normal,{escape:e(j.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:e(j.text)("]|","~]|")("|","|https?://|")()}),j.breaks=g({},j.gfm,{br:e(j.br)("{2,}","*")(),text:e(j.gfm.text)("{2,}","*")()}),b.rules=j,b.output=function(a,c,d){var e=new b(c,d);return e.output(a)},b.prototype.output=function(a){for(var b,c,e,f,g="";a;)if(f=this.rules.escape.exec(a))a=a.substring(f[0].length),g+=f[1];else if(f=this.rules.autolink.exec(a))a=a.substring(f[0].length),"@"===f[2]?(c=":"===f[1].charAt(6)?this.mangle(f[1].substring(7)):this.mangle(f[1]),e=this.mangle("mailto:")+c):(c=d(f[1]),e=c),g+='<a href="'+e+'">'+c+"</a>";else if(f=this.rules.url.exec(a))a=a.substring(f[0].length),c=d(f[1]),e=c,g+='<a href="'+e+'">'+c+"</a>";else if(f=this.rules.tag.exec(a))a=a.substring(f[0].length),g+=this.options.sanitize?d(f[0]):f[0];else if(f=this.rules.link.exec(a))a=a.substring(f[0].length),g+=this.outputLink(f,{href:f[2],title:f[3]});else if((f=this.rules.reflink.exec(a))||(f=this.rules.nolink.exec(a))){if(a=a.substring(f[0].length),b=(f[2]||f[1]).replace(/\s+/g," "),b=this.links[b.toLowerCase()],!b||!b.href){g+=f[0].charAt(0),a=f[0].substring(1)+a;continue}g+=this.outputLink(f,b)}else if(f=this.rules.strong.exec(a))a=a.substring(f[0].length),g+="<strong>"+this.output(f[2]||f[1])+"</strong>";else if(f=this.rules.em.exec(a))a=a.substring(f[0].length),g+="<em>"+this.output(f[2]||f[1])+"</em>";else if(f=this.rules.code.exec(a))a=a.substring(f[0].length),g+="<code>"+d(f[2],!0)+"</code>";else if(f=this.rules.br.exec(a))a=a.substring(f[0].length),g+="<br>";else if(f=this.rules.del.exec(a))a=a.substring(f[0].length),g+="<del>"+this.output(f[1])+"</del>";else if(f=this.rules.text.exec(a))a=a.substring(f[0].length),g+=d(this.smartypants(f[0]));else if(a)throw new Error("Infinite loop on byte: "+a.charCodeAt(0));return g},b.prototype.outputLink=function(a,b){return"!"!==a[0].charAt(0)?'<a href="'+d(b.href)+'"'+(b.title?' title="'+d(b.title)+'"':"")+">"+this.output(a[1])+"</a>":'<img src="'+d(b.href)+'" alt="'+d(a[1])+'"'+(b.title?' title="'+d(b.title)+'"':"")+">"},b.prototype.smartypants=function(a){return this.options.smartypants?a.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):a},b.prototype.mangle=function(a){for(var b,c="",d=a.length,e=0;d>e;e++)b=a.charCodeAt(e),Math.random()>.5&&(b="x"+b.toString(16)),c+="&#"+b+";";return c},c.parse=function(a,b){var d=new c(b);return d.parse(a)},c.prototype.parse=function(a){this.inline=new b(a.links,this.options),this.tokens=a.reverse();for(var c="";this.next();)c+=this.tok();return c},c.prototype.next=function(){return this.token=this.tokens.pop()},c.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},c.prototype.parseText=function(){for(var a=this.token.text;"text"===this.peek().type;)a+="\n"+this.next().text;return this.inline.output(a)},c.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+this.token.depth+' id="'+this.token.text.toLowerCase().replace(/[^\w]+/g,"-")+'">'+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n";case"code":if(this.options.highlight){var a=this.options.highlight(this.token.text,this.token.lang);null!=a&&a!==this.token.text&&(this.token.escaped=!0,this.token.text=a)}return this.token.escaped||(this.token.text=d(this.token.text,!0)),"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+this.token.lang+'"':"")+">"+this.token.text+"</code></pre>\n";case"table":var b,c,e,f,g,h="";for(h+="<thead>\n<tr>\n",c=0;c<this.token.header.length;c++)b=this.inline.output(this.token.header[c]),h+="<th",this.token.align[c]&&(h+=' style="text-align:'+this.token.align[c]+'"'),h+=">"+b+"</th>\n";for(h+="</tr>\n</thead>\n",h+="<tbody>\n",c=0;c<this.token.cells.length;c++){for(e=this.token.cells[c],h+="<tr>\n",g=0;g<e.length;g++)f=this.inline.output(e[g]),h+="<td",this.token.align[g]&&(h+=' style="text-align:'+this.token.align[g]+'"'),h+=">"+f+"</td>\n";h+="</tr>\n"}return h+="</tbody>\n","<table>\n"+h+"</table>\n";case"blockquote_start":for(var h="";"blockquote_end"!==this.next().type;)h+=this.tok();return"<blockquote>\n"+h+"</blockquote>\n";case"list_start":for(var i=this.token.ordered?"ol":"ul",h="";"list_end"!==this.next().type;)h+=this.tok();return"<"+i+">\n"+h+"</"+i+">\n";case"list_item_start":for(var h="";"list_item_end"!==this.next().type;)h+="text"===this.token.type?this.parseText():this.tok();return"<li>"+h+"</li>\n";case"loose_item_start":for(var h="";"list_item_end"!==this.next().type;)h+=this.tok();return"<li>"+h+"</li>\n";case"html":return this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);case"paragraph":return"<p>"+this.inline.output(this.token.text)+"</p>\n";case"text":return"<p>"+this.parseText()+"</p>\n"}},f.exec=f,h.options=h.setOptions=function(a){return g(h.defaults,a),h},h.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1},h.Parser=c,h.parser=c.parse,h.Lexer=a,h.lexer=a.lex,h.InlineLexer=b,h.inlineLexer=b.output,h.parse=h,"object"==typeof exports?module.exports=h:"function"==typeof define&&define.amd?define("marked",[],function(){return h}):this.marked=h}.call(function(){return this||("undefined"!=typeof window?window:global)}()),define("directives/Markdown",["marked"],function(a){var b=angular.module("commissar.directives.Markdown",[]);return b.directive("markdown",function(){var b=function(b,c,d,e){var f=function(){try{var b=a(e.$modelValue);if(c.html(b),"undefined"!=typeof d.firstparagraph){var f=document.createElement("div");f.appendChild(c.find("p")[0].cloneNode(!0)),c.html(f.innerHTML)}if("undefined"!=typeof d.textonly&&c.html(c.text()),"undefined"!=typeof d.wordlimit){var g=parseInt(d.wordlimit,10),h=c.text().split(" ");if(h.length>g){for(var i=[],j=0;g>j;j++)i.push(h[j]);i.push("..."),h=i}c.html(h.join(" "))}}catch(k){}};b.$watch(d.ngModel,f),f()};return{restrict:"A",require:"ngModel",link:b}}),b}),define("filters/Capitalize",[],function(){var a=angular.module("commissar.filters.Capitalize",[]);a.filter("Capitalize",function(){return function(a){return a?a.substring(0,1).toUpperCase()+a.substring(1):null}})}),define("controllers/LogoutCtrl",["constants","../services/Authentication","../directives/Markdown","../filters/Capitalize"],function(a){var b=angular.module("commissar.controllers.LogoutCtrl",["commissar.services.Authentication"]);return b.controller("LogoutCtrl",["$scope","Authentication",function(a,b){a.name="LogoutCtrl",b.logout()}]),b.config(["$routeProvider",function(b){b.when("/logout",{templateUrl:a.templatePrefix+"logout.html",controller:"LogoutCtrl"})}]),b}),define("controllers/AdminCtrl",["constants"],function(a){var b=angular.module("commissar.controllers.AdminCtrl",["commissar.services.Authentication","commissar.directives.Markdown","commissar.filters.Capitalize"]);return b.controller("AdminCtrl",["$scope","Couch",function(a,b){a.name="AdminCtrl",a.pushDesignDocs=function(){a.pushingDesignDocs=!0,a.pushDesignDocsErrors=!1,b.pushDesignDocs().then(function(){a.pushingDesignDocs=!1},function(b){a.pushingDesignDocs=!1,a.pushDesignDocsErrors=b})},a.pushingDesignDocs=!1,a.pushDesignDocsErrors=!1}]),b.config(["$routeProvider",function(b){b.when("/admin",{templateUrl:a.templatePrefix+"admin.html",controller:"AdminCtrl"})}]),b}),define("controllers/IndexCtrl",["constants","../services/Authentication","../directives/Markdown","../filters/Capitalize"],function(a){var b=angular.module("commissar.controllers.IndexCtrl",["commissar.services.Authentication","commissar.directives.Markdown","commissar.filters.Capitalize"]);
return b.controller("IndexCtrl",["$scope",function(a){a.name="IndexCtrl"}]),b.config(["$routeProvider",function(b){b.when("/",{templateUrl:a.templatePrefix+"index.html",controller:"IndexCtrl"}),b.otherwise({redirectTo:"/"})}]),b}),define("controllers/WelcomeCtrl",["constants","services/Authentication","directives/Markdown","filters/Capitalize"],function(a){var b=angular.module("commissar.controllers.WelcomeCtrl",["commissar.services.Authentication","commissar.directives.Markdown","commissar.filters.Capitalize"]);return b.controller("WelcomeCtrl",["$scope",function(a){a.name="WelcomeCtrl"}]),b.config(["$routeProvider",function(b){b.when("/welcome",{templateUrl:a.templatePrefix+"welcome.html",controller:"WelcomeCtrl"})}]),b}),define("services/ParanoidScope",[],function(){var a=angular.module("commissar.services.ParanoidScope",[]);return a.factory("ParanoidScope",function(){var a={apply:function(a,b){"undefined"==typeof b&&(b=function(){}),a.$$phase||a.$root.$$phase?b():a.$apply(b)},digest:function(a,b){"undefined"==typeof b&&(b=function(){}),a.$$phase||a.$root.$$phase?b():a.$digest(b)}};return a}),a}),define("directives/LoginForm",["constants","services/Authentication","services/ParanoidScope"],function(a){var b=angular.module("commissar.directives.LoginForm",["commissar.services.Authentication","commissar.services.ParanoidScope"]);return b.controller("commissar.directives.LoginForm.controller",["$scope","Authentication","$location","ParanoidScope","$timeout",function(a,b,c,d,e){a.name="commissar.directives.LoginForm.controller",a.loggedIn=null,a.accessDenied=!1,a.loginAttemptedRecently=!1,b.loggedIn().then(function(b){a.loggedIn=b}),a.login=function(c,d){return"undefined"==typeof c&&(c=a.loginFormUsername),"undefined"==typeof d&&(d=a.loginFormPassword),b.login(c,d).then(function(b){return a.loggedIn=!!b,a.accessDenied=!b,a.loginAttemptedRecently=!0,e(function(){a.loginAttemptedRecently=!1},1e3),b&&(a.loginFormUsername="",a.loginFormPassword=""),b})},a.userExists=function(c){return"undefined"==typeof c&&(c=a.loginFormUsername),b.userExists(c).then(function(a){return a})},a.register=function(d,e){"undefined"==typeof d&&(d=a.loginFormUsername),"undefined"==typeof e&&(e=a.loginFormPassword);var f=b.register(d,e);return f.then(function(a){a===!0&&b.login(d,e).then(function(){c.path("/welcome")})}),f},function(){var c=null,e=null;a.isUsernameRecognised=function(f){var g=null;return"undefined"==typeof f&&(f=a.loginFormUsername),f===c?g=e:(c=f,e=!1,b.userExists(f).then(function(b){d.apply(a,function(){e=b})}),g=!1),g},a.$watch("loginFormUsername",function(){a.isUsernameRecognised()})}()}]),b.directive("loginForm",function(){var b={priority:0,templateUrl:a.templatePrefix+"directives/LoginForm.html",replace:!0,transclude:!0,restrict:"AE",scope:{},controller:"commissar.directives.LoginForm.controller"};return b}),b}),define("controllers/MenuCtrl",["services/Authentication","filters/Capitalize","directives/LoginForm","services/ParanoidScope"],function(){var a=angular.module("commissar.controllers.MenuCtrl",["commissar.services.Authentication","commissar.directives.Markdown","commissar.filters.Capitalize","commissar.directives.LoginForm","commissar.services.ParanoidScope"]);return a.controller("MenuCtrl",["$scope","Authentication","ParanoidScope","$q",function(a,b,c,d){a.name="MenuCtrl",a.loggedIn=!1,a.isAdmin=!1,a.onAuthChange=function(){d.all([b.loggedIn(),b.getSession(),b.isAdmin()]).then(function(b){a.loggedIn=b[0],a.userCtx=b[1],a.isAdmin=b[2],c.apply(a),c.digest(a)})},a.onAuthChange(),a.$on("AuthChange",a.onAuthChange),a.logout=function(){b.logout()}}]),a}),define("directives/UploadForm",["constants","services/Authentication","services/ParanoidScope","services/Couch","services/Random"],function(a){var b=angular.module("commissar.directives.UploadForm",["commissar.services.Authentication","commissar.services.ParanoidScope","commissar.services.Couch","commissar.services.Random"]);return b.controller("commissar.directives.UploadForm.controller",["$scope","$q","Couch","Authentication","Random",function(a,b,c,d,e){a.name="commissar.directives.UploadForm.controller",a.valid=function(){return!!a.uploadFormName&&!!a.uploadFormFile},a.fileChanged=function(b,c){a.$apply(function(){a.uploadFormFile=c[0].files})},a.$on("filechanged",function(){a.fileChanged.apply(a,arguments)}),a.upload=function(){var f=b.defer();return a.valid()?d.getUsername().then(function(b){var g=d.getDatabaseName(b);c.newDoc(g).then(function(d){d._id=b+"_media_"+e.getHash(),d.author=b,d.type="media",d.mediaType="image",d.title=a.uploadFormName,d.created=Math.floor(Date.now()/1e3),c.saveDoc(d,g).then(function(){d.attach(a.uploadFormFile[0]).then(function(){f.resolve(!0)},f.reject)},f.reject)})},f.reject):f.reject("Not valid"),f.promise}}]),b.directive("uploadForm",function(){var b={priority:0,templateUrl:a.templatePrefix+"directives/UploadForm.html",replace:!0,transclude:!0,restrict:"AE",scope:{},controller:"commissar.directives.UploadForm.controller",link:function(a,b){var c=jQuery(b).find("input[type=file]");c.on("change",function(b){a.$broadcast("filechanged",c,b)})}};return b}),b}),define("directives/Media",["constants","services/Authentication","services/ParanoidScope"],function(a){var b=angular.module("commissar.directives.Media",["commissar.services.Authentication","commissar.services.ParanoidScope"]);return b.controller("commissar.directives.Media.controller",["$scope",function(b){b.name="commissar.directives.Media.controller",b.className=function(){var c=b.document.mediaType;return a.allowedMediaTypes.indexOf(c)<0&&(c=""),"media "+c}}]),b.directive("media",function(){var b={priority:0,templateUrl:a.templatePrefix+"directives/Media.html",replace:!0,transclude:!0,restrict:"AE",scope:{},controller:"commissar.directives.Media.controller"};return b}),b}),define("services/ImageManager",["./Authentication","./Couch"],function(){var a=angular.module("commissar.services.ImageManager",["commissar.services.Authentication","commissar.services.Couch"]);return a.factory("ImageManager",["Authentication","Couch","$q","$http",function(a,b,c,d){var e={};return e.getMyImages=function(){var b=c.defer();return a.getUsername().then(function(c){d.get("/couchdb/"+a.getDatabaseName(c)+"/_design/validation_user_media/_view/all").success(function(a){b.resolve(a.rows)}).error(b.reject)},b.reject),b.promise},e}]),a}),define("controllers/GalleryCtrl",["constants","directives/UploadForm","directives/Media","services/ImageManager","services/ParanoidScope"],function(a){var b=angular.module("commissar.controllers.GalleryCtrl",["commissar.directives.UploadForm","commissar.directives.Media","commissar.services.ImageManager","commissar.services.ParanoidScope"]);return b.controller("GalleryCtrl",["$scope","ImageManager","ParanoidScope",function(a,b,c){a.name="GalleryCtrl",b.getMyImages().then(function(b){c.apply(a,function(){a.images=b})})}]),b.config(["$routeProvider",function(b){b.when("/my/gallery",{templateUrl:a.templatePrefix+"gallery/index.html",controller:"GalleryCtrl"}),b.when("/my/gallery/upload",{templateUrl:a.templatePrefix+"gallery/upload.html",controller:"GalleryCtrl"}),b.when("/:userslug/gallery",{templateUrl:a.templatePrefix+"gallery/index.html",controller:"GalleryCtrl"})}]),b}),define("app",["controllers/LogoutCtrl","controllers/AdminCtrl","controllers/IndexCtrl","controllers/WelcomeCtrl","controllers/MenuCtrl","controllers/GalleryCtrl"],function(){var a=angular.module("commissar",["commissar.controllers.LogoutCtrl","commissar.controllers.AdminCtrl","commissar.controllers.IndexCtrl","commissar.controllers.MenuCtrl","commissar.controllers.WelcomeCtrl","commissar.controllers.GalleryCtrl"]);return a.config(["$locationProvider",function(a){a.html5Mode(!1),a.hashPrefix("!")}]),a}),angular.mock={},angular.mock.$BrowserProvider=function(){this.$get=function(){return new angular.mock.$Browser}},angular.mock.$Browser=function(){var a=this;this.isMock=!0,a.$$url="http://server/",a.$$lastUrl=a.$$url,a.pollFns=[],a.$$completeOutstandingRequest=angular.noop,a.$$incOutstandingRequestCount=angular.noop,a.onUrlChange=function(b){return a.pollFns.push(function(){a.$$lastUrl!=a.$$url&&(a.$$lastUrl=a.$$url,b(a.$$url))}),b},a.cookieHash={},a.lastCookieHash={},a.deferredFns=[],a.deferredNextId=0,a.defer=function(b,c){return c=c||0,a.deferredFns.push({time:a.defer.now+c,fn:b,id:a.deferredNextId}),a.deferredFns.sort(function(a,b){return a.time-b.time}),a.deferredNextId++},a.defer.now=0,a.defer.cancel=function(b){var c;return angular.forEach(a.deferredFns,function(a,d){a.id===b&&(c=d)}),void 0!==c?(a.deferredFns.splice(c,1),!0):!1},a.defer.flush=function(b){if(angular.isDefined(b))a.defer.now+=b;else{if(!a.deferredFns.length)throw Error("No deferred tasks to be flushed");a.defer.now=a.deferredFns[a.deferredFns.length-1].time}for(;a.deferredFns.length&&a.deferredFns[0].time<=a.defer.now;)a.deferredFns.shift().fn()},a.$$baseHref="",a.baseHref=function(){return this.$$baseHref}},angular.mock.$Browser.prototype={poll:function(){angular.forEach(this.pollFns,function(a){a()})},addPollFn:function(a){return this.pollFns.push(a),a},url:function(a){return a?(this.$$url=a,this):this.$$url},cookies:function(a,b){return a?(void 0==b?delete this.cookieHash[a]:angular.isString(b)&&b.length<=4096&&(this.cookieHash[a]=b),void 0):(angular.equals(this.cookieHash,this.lastCookieHash)||(this.lastCookieHash=angular.copy(this.cookieHash),this.cookieHash=angular.copy(this.cookieHash)),this.cookieHash)},notifyWhenNoOutstandingRequests:function(a){a()}},angular.mock.$ExceptionHandlerProvider=function(){var a;this.mode=function(b){switch(b){case"rethrow":a=function(a){throw a};break;case"log":var c=[];a=function(a){1==arguments.length?c.push(a):c.push([].slice.call(arguments,0))},a.errors=c;break;default:throw Error("Unknown mode '"+b+"', only 'log'/'rethrow' modes are allowed!")}},this.$get=function(){return a},this.mode("rethrow")},angular.mock.$LogProvider=function(){function a(a,b,c){return a.concat(Array.prototype.slice.call(b,c))}this.$get=function(){var b={log:function(){b.log.logs.push(a([],arguments,0))},warn:function(){b.warn.logs.push(a([],arguments,0))},info:function(){b.info.logs.push(a([],arguments,0))},error:function(){b.error.logs.push(a([],arguments,0))}};return b.reset=function(){b.log.logs=[],b.warn.logs=[],b.info.logs=[],b.error.logs=[]},b.assertEmpty=function(){var a=[];if(angular.forEach(["error","warn","info","log"],function(c){angular.forEach(b[c].logs,function(b){angular.forEach(b,function(b){a.push("MOCK $log ("+c+"): "+String(b)+"\n"+(b.stack||""))})})}),a.length)throw a.unshift("Expected $log to be empty! Either a message was logged unexpectedly, or an expected log message was not checked and removed:"),a.push(""),new Error(a.join("\n---------\n"))},b.reset(),b}},function(){function a(a){var c;if(c=a.match(d)){var e=new Date(0),f=0,g=0;return c[9]&&(f=b(c[9]+c[10]),g=b(c[9]+c[11])),e.setUTCFullYear(b(c[1]),b(c[2])-1,b(c[3])),e.setUTCHours(b(c[4]||0)-f,b(c[5]||0)-g,b(c[6]||0),b(c[7]||0)),e}return a}function b(a){return parseInt(a,10)}function c(a,b,c){var d="";for(0>a&&(d="-",a=-a),a=""+a;a.length<b;)a="0"+a;return c&&(a=a.substr(a.length-b)),d+a}var d=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?:\:?(\d\d)(?:\:?(\d\d)(?:\.(\d{3}))?)?)?(Z|([+-])(\d\d):?(\d\d)))?$/;angular.mock.TzDate=function(b,d){var e=new Date(0);if(angular.isString(d)){var f=d;if(e.origDate=a(d),d=e.origDate.getTime(),isNaN(d))throw{name:"Illegal Argument",message:"Arg '"+f+"' passed into TzDate constructor is not a valid date string"}}else e.origDate=new Date(d);var g=new Date(d).getTimezoneOffset();e.offsetDiff=60*g*1e3-1e3*b*60*60,e.date=new Date(d+e.offsetDiff),e.getTime=function(){return e.date.getTime()-e.offsetDiff},e.toLocaleDateString=function(){return e.date.toLocaleDateString()},e.getFullYear=function(){return e.date.getFullYear()},e.getMonth=function(){return e.date.getMonth()},e.getDate=function(){return e.date.getDate()},e.getHours=function(){return e.date.getHours()},e.getMinutes=function(){return e.date.getMinutes()},e.getSeconds=function(){return e.date.getSeconds()},e.getTimezoneOffset=function(){return 60*b},e.getUTCFullYear=function(){return e.origDate.getUTCFullYear()},e.getUTCMonth=function(){return e.origDate.getUTCMonth()},e.getUTCDate=function(){return e.origDate.getUTCDate()},e.getUTCHours=function(){return e.origDate.getUTCHours()},e.getUTCMinutes=function(){return e.origDate.getUTCMinutes()},e.getUTCSeconds=function(){return e.origDate.getUTCSeconds()},e.getUTCMilliseconds=function(){return e.origDate.getUTCMilliseconds()},e.getDay=function(){return e.date.getDay()},e.toISOString&&(e.toISOString=function(){return c(e.origDate.getUTCFullYear(),4)+"-"+c(e.origDate.getUTCMonth()+1,2)+"-"+c(e.origDate.getUTCDate(),2)+"T"+c(e.origDate.getUTCHours(),2)+":"+c(e.origDate.getUTCMinutes(),2)+":"+c(e.origDate.getUTCSeconds(),2)+"."+c(e.origDate.getUTCMilliseconds(),3)+"Z"});var h=["getMilliseconds","getUTCDay","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toGMTString","toJSON","toLocaleFormat","toLocaleString","toLocaleTimeString","toSource","toString","toTimeString","toUTCString","valueOf"];return angular.forEach(h,function(a){e[a]=function(){throw Error("Method '"+a+"' is not implemented in the TzDate mock")}}),e},angular.mock.TzDate.prototype=Date.prototype}(),angular.mock.dump=function(a){function b(a){var d;return angular.isElement(a)?(a=angular.element(a),d=angular.element("<div></div>"),angular.forEach(a,function(a){d.append(angular.element(a).clone())}),d=d.html()):angular.isArray(a)?(d=[],angular.forEach(a,function(a){d.push(b(a))}),d="[ "+d.join(", ")+" ]"):d=angular.isObject(a)?angular.isFunction(a.$eval)&&angular.isFunction(a.$apply)?c(a):a instanceof Error?a.stack||""+a.name+": "+a.message:angular.toJson(a,!0):String(a),d}function c(a,b){b=b||"  ";var d=[b+"Scope("+a.$id+"): {"];for(var e in a)a.hasOwnProperty(e)&&!e.match(/^(\$|this)/)&&d.push("  "+e+": "+angular.toJson(a[e]));for(var f=a.$$childHead;f;)d.push(c(f,b+"  ")),f=f.$$nextSibling;return d.push("}"),d.join("\n"+b)}return b(a)},angular.mock.$HttpBackendProvider=function(){this.$get=[createHttpBackendMock]},angular.mock.$RootElementProvider=function(){this.$get=function(){return angular.element("<div ng-app></div>")}},angular.module("ngMock",["ng"]).provider({$browser:angular.mock.$BrowserProvider,$exceptionHandler:angular.mock.$ExceptionHandlerProvider,$log:angular.mock.$LogProvider,$httpBackend:angular.mock.$HttpBackendProvider,$rootElement:angular.mock.$RootElementProvider}).config(function(a){a.decorator("$timeout",function(a,b){return a.flush=function(a){b.defer.flush(a)},a})}),angular.module("ngMockE2E",["ng"]).config(["$provide",function(a){a.decorator("$httpBackend",angular.mock.e2e.$httpBackendDecorator)}]),angular.mock.e2e={},angular.mock.e2e.$httpBackendDecorator=["$delegate","$browser",createHttpBackendMock],angular.mock.clearDataCache=function(){var a,b=angular.element.cache;for(a in b)if(b.hasOwnProperty(a)){var c=b[a].handle;c&&angular.element(c.elem).unbind(),delete b[a]}},window.jasmine&&function(a){function b(){return jasmine.getEnv().currentSpec}function c(){var a=b();return a&&a.queue.running}afterEach(function(){var a=b(),c=a.$injector;a.$injector=null,a.$modules=null,c&&(c.get("$rootElement").unbind(),c.get("$browser").pollFns.length=0),angular.mock.clearDataCache(),angular.forEach(angular.element.fragments,function(a,b){delete angular.element.fragments[b]}),MockXhr.$$lastInstance=null,angular.forEach(angular.callbacks,function(a,b){delete angular.callbacks[b]}),angular.callbacks.counter=0}),a.module=angular.mock.module=function(){function a(){var a=b();if(a.$injector)throw Error("Injector already created, can not register a module!");var c=a.$modules||(a.$modules=[]);angular.forEach(d,function(a){c.push(a)})}var d=Array.prototype.slice.call(arguments,0);return c()?a():a},a.inject=angular.mock.inject=function(){function a(){var a=b(),c=a.$modules||[];c.unshift("ngMock"),c.unshift("ng");var f=a.$injector;f||(f=a.$injector=angular.injector(c));for(var g=0,h=d.length;h>g;g++)try{f.invoke(d[g]||angular.noop,this)}catch(i){throw i.stack&&e&&(i.stack+="\n"+e.stack),i}finally{e=null}}var d=Array.prototype.slice.call(arguments,0),e=new Error("Declaration Location");return c()?a():a}}(window),define("angularMocks",function(){}),define("startup",["app","angularMocks"],function(a){return function(){if(window.e2emocks){console.log("RUNNING MOCKED");var b=angular.module("commissar_mocked",["commissar","ngMockE2E"]);b.run(["$httpBackend",function(a){a.whenGET("/couchdb/_all_dbs").respond(200,["_replicator","_users","commissar","commissar_user_john","commissar_validation_global","commissar_validation_users"]),a.whenPOST("/server/register.php").respond(200,{ok:!0}),a.whenGET("/couchdb/_session").respond(200,{ok:!1,userCtx:{name:null,roles:[]},info:{authentication_db:"_users",authentication_handlers:["oauth","cookie","default"]}}),a.whenPOST("/couchdb/_session").respond(200,{ok:!0,name:"a_new_username",roles:["+admin"]}),a.whenGET(/templates/).passThrough(),a.whenGET(/.*/).respond(404,"NOT SET UP IN E2EMOCKS YET")}]),a=b}var c=document.getElementsByTagName("html")[0];if(c.setAttribute("ng-app",a.name),c.dataset.ngApp=a.name,top!==window&&(top.postMessage({type:"apploaded"},"*"),console.log("Posted message!")),console.log(angular.module("commissar")),window.useTemplateModule){var d=angular.module("commissar_templated",[a.name]);require(["/js/templates.min.js"],function(a){a(d),angular.bootstrap(document,[d.name])})}else console.log("RUNNING WITHOUT TEMPLATE MODULE"),angular.bootstrap(document,[a.name])}});